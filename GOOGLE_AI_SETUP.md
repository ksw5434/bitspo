# Google AI API 설정 가이드

뉴스 요약 기능을 사용하기 위해 Google AI API 키를 설정해야 합니다.

## 1. Google AI API 키 발급

1. [Google AI Studio](https://aistudio.google.com/)에 접속합니다.
2. Google 계정으로 로그인합니다.
3. 좌측 메뉴에서 "Get API key"를 클릭합니다.
4. "Create API key" 버튼을 클릭하여 새 API 키를 생성합니다.
5. 생성된 API 키를 복사합니다. (예: `AIzaSy...`)

## 2. 환경 변수 설정

프로젝트 루트 디렉토리에 `.env.local` 파일을 생성하고 다음 내용을 추가합니다:

```env
GOOGLE_AI_API_KEY=여기에_발급받은_API_키_입력
```

**주의사항:**

- `.env.local` 파일은 Git에 커밋하지 마세요. (이미 `.gitignore`에 포함되어 있을 것입니다)
- API 키는 절대 공개 저장소에 노출되지 않도록 주의하세요.

## 3. 서버 재시작

환경 변수를 추가한 후에는 개발 서버를 재시작해야 합니다:

```bash
npm run dev
```

## 4. 사용 모델

현재 구현에서는 `gemini-1.5-flash` 모델을 사용합니다. 이 모델은 빠르고 비용 효율적이며, Google AI API의 최신 모델입니다.

**참고**: `gemini-pro`는 더 이상 지원되지 않습니다. 최신 API에서는 `gemini-1.5-flash` 또는 `gemini-1.5-pro`를 사용해야 합니다.

## 5. API 사용량 및 비용

- Google AI API는 무료 티어를 제공하지만, 사용량 제한이 있습니다.
- 프로덕션 환경에서는 Google Cloud Console에서 사용량을 모니터링하세요.
- 비용이 발생할 수 있으므로 필요시 사용량 제한을 설정하세요.

## 6. 문제 해결

### API 키 오류

- `.env.local` 파일이 프로젝트 루트에 있는지 확인하세요.
- API 키 앞뒤에 공백이나 따옴표가 없는지 확인하세요.
- 서버를 재시작했는지 확인하세요.

### 요약 생성 실패

- 네트워크 연결을 확인하세요.
- API 키가 유효한지 확인하세요.
- Google AI Studio에서 API 키의 사용량 제한을 확인하세요.

## 7. 데이터베이스 마이그레이션

요약 기능을 사용하기 전에 데이터베이스 마이그레이션을 실행해야 합니다:

1. Supabase 대시보드의 SQL Editor로 이동합니다.
2. `lib/supabase/migration_add_summary_field.sql` 파일의 내용을 복사하여 실행합니다.
3. 이 마이그레이션은 `news` 테이블에 `summary` 컬럼을 추가합니다.

**중요**: 이 마이그레이션은 요약 결과를 데이터베이스에 캐싱하여 API 비용을 절감합니다.

## 8. 비용 최적화

현재 구현은 다음과 같이 비용을 최적화합니다:

- **DB 캐싱**: 동일한 뉴스에 대해 한 번만 API를 호출하고 결과를 DB에 저장합니다.
- **자동 재사용**: 이후 동일한 뉴스를 조회할 때는 DB에서 요약을 가져옵니다.
- **강제 재생성**: 필요시 `?force=true` 파라미터로 요약을 재생성할 수 있습니다.

## 9. 보안 권장사항

- 프로덕션 환경에서는 환경 변수를 안전하게 관리하세요 (예: Vercel, AWS Secrets Manager 등)
- API 키를 클라이언트 사이드 코드에 직접 포함하지 마세요.
- 현재 구현은 서버 사이드 API 라우트를 통해 안전하게 처리됩니다.
